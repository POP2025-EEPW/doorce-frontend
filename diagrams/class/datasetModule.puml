@startuml
title Dataset Feature - PVCUC component view

skinparam packageStyle rectangle

package "Views" {
  class DatasetInfoView {
    +render(dataset)
  }
  class AddDatasetFormView {
    +render()
    +submit(input)
  }
  class AddDatasetSectionView {
    +render(catalogId, ownerId)
  }
  class DatasetTableView {
    +render(datasets)
    +onOpen(id)
  }
  class EditDatasetFormView {
    +render(dataset)
    +onSubmit(input)
    +onCancel()
    +onSetSchema()
  }
  class SelectDataSchemaModalView {
    +render(open, schemas, selectedSchemaId)
    +onSelectSchema(schemaId)
    +onConfirm()
    +onCancel()
    +onOpenChange(open)
  }
  class AddDatasetCommentFormView {
    +render(dataset)
    +onSubmit(text)
  }
}

package "Presenters" {
  class DatasetDetailPresenter {
    +render()
    +loadDataset(id)
  }
  class CatalogDetailPresenter {
    +render()
    +handleAddDataset(input)
    +loadCatalogDatasets(catalogId)
  }
  class DatasetEditPresenter {
    +render()
    +handleSubmit(input)
    +handleSetSchema()
    +handleCancel()
  }
  class SelectDataSchemaModalPresenter {
    +render()
    +loadSchemas()
    +handleConfirm()
    +handleCancel()
    +handleOpenChange(open)
  }
  class AddDatasetCommentPresenter {
    +render()
    +handleSubmit(text)
  }
}

package "Controllers" {
  class DatasetsController {
    +getDataset(id)
    +addDataset(input)
    +listCatalogDatasets(catalogId, page, pageSize)
    +listDatasets(filter, page, pageSize)
    +getDatasetDescription(datasetId)
    +listOwnedDatasets(ownerId)
    +listQualityControllableDatasets(controllerId)
    +updateDataset(id, input)
    +setDataSchemaForDataset(datasetId, schemaId)
    +loadDataSchemas()
  }
  class CatalogsController {
    +getCatalog(id)
    +listCatalogs(parentId)
  }
  class DatasetCommentController {
    +submitDatasetComment(datasetId, text)
  }
}

package "Use-case Layer" {
  interface DatasetUseCases {
    +getDataset(id)
    +addDataset(input)
    +updateDataset(id, input)
    +setDataSchemaForDataset(datasetId, schemaId)
    +listCatalogDatasets(catalogId, page, pageSize)
    +getCatalog(id)
    +listCatalogs(parentId)
    +listDatasets(filter, page, pageSize)
    +getDatasetDescription(datasetId)
    +listOwnedDatasets(ownerId)
    +listQualityControllableDatasets(controllerId)
    +listDataSchemas()
  }
  interface QualityUseCases {
    +addDatasetComment(datasetId, input)
    +listDatasetComments(datasetId)
  }
}

package "DI Container" {
  class UCContainer {
    +dataset: DatasetUseCases
    +quality: QualityUseCases
  }
}

DatasetDetailPresenter --> DatasetInfoView : render()
DatasetInfoView --> DatasetDetailPresenter : props/events
DatasetDetailPresenter --> DatasetsController : loadDataset(id)

CatalogDetailPresenter --> DatasetTableView : render()
DatasetTableView --> CatalogDetailPresenter : onOpen(id)
CatalogDetailPresenter --> AddDatasetSectionView : render()
AddDatasetSectionView --> AddDatasetFormView : compose
AddDatasetFormView --> CatalogDetailPresenter : onSubmit(input)
CatalogDetailPresenter --> DatasetsController : add/list datasets
CatalogDetailPresenter --> CatalogsController : get catalog context

DatasetsController --> DatasetUseCases : delegates
CatalogsController --> DatasetUseCases : delegates shared calls

DatasetsController --> UCContainer : reads dataset uc
CatalogsController --> UCContainer : reads dataset uc
UCContainer --> DatasetUseCases : provides implementation

DatasetEditPresenter --> EditDatasetFormView : render()
EditDatasetFormView --> DatasetEditPresenter : onSubmit(), onCancel(), onSetSchema()
DatasetEditPresenter --> SelectDataSchemaModalPresenter : open/close modal
DatasetEditPresenter --> DatasetsController : loadDataset(), updateDataset()


DatasetEditPresenter --> SelectDataSchemaModalPresenter : open modal
SelectDataSchemaModalPresenter --> SelectDataSchemaModalView : render()
SelectDataSchemaModalView --> SelectDataSchemaModalPresenter : onSelectSchema(), onConfirm(), onCancel(), onOpenChange()

SelectDataSchemaModalPresenter --> DatasetsController : loadDataSchemas(), setDataSchemaForDataset()

AddDatasetCommentPresenter --> AddDatasetCommentFormView : render()
AddDatasetCommentFormView --> AddDatasetCommentPresenter : onSubmit(text)

AddDatasetCommentPresenter --> DatasetCommentController : submitDatasetComment(datasetId, text)
DatasetCommentController --> QualityUseCases : delegates addDatasetComment(datasetId, input)

DatasetCommentController --> UCContainer : reads quality uc
UCContainer --> QualityUseCases : provides implementation
@enduml
