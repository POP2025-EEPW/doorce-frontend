@startuml
title Dataset Feature - PVCUC component view

skinparam packageStyle rectangle

package "Views" {
  class DatasetInfoView {
    +render(dataset)
  }
  class AddDatasetFormView {
    +render()
    +submit(input)
  }
  class AddDatasetSectionView {
    +render(catalogId, ownerId)
  }
  class DatasetTableView {
    +render(datasets)
    +onOpen(id)
  }
  class DatasetCommentsView {
    +render(comments)
    +onShowComments(datasetId)
  }
  class DatasetListView {
    +render()
  }
  class CatalogsPageView {
    +render()
  }
  class AddDataRelatedRequestModal {
    +render()
    +handleSubmit(e?)
    +loadRequests(pageNum)
  }
}

package "Presenters" {
  class DatasetDetailPresenter {
    +render()
    +loadDataset(id)
  }
  class CatalogDetailPresenter {
    +render()
    +handleAddDataset(input)
    +loadCatalogDatasets(catalogId)
  }
}

package "Controllers" {
  class DatasetsController {
    +getDataset(id)
    +addDataset(input)
    +listCatalogDatasets(catalogId, page, pageSize)
    +listDatasets(filter, page, pageSize)
    +getDatasetDescription(datasetId)
    +listOwnedDatasets(ownerId)
    +listQualityControllableDatasets(controllerId)
    +loadDatasetComments(datasetId)
    +getDatasetComents(datasetId)
  }
  class CatalogsController {
    +getCatalog(id)
    +listCatalogs(parentId)
  }
}

package "Use-case Layer" {
  interface DatasetUseCases {
    +getDataset(id)
    +addDataset(input)
    +listCatalogDatasets(catalogId, page, pageSize)
    +getCatalog(id)
    +listCatalogs(parentId)
    +listDatasets(filter, page, pageSize)
    +getDatasetDescription(datasetId)
    +listOwnedDatasets(ownerId)
    +listQualityControllableDatasets(controllerId)
    +getDatasetComments(datasetId)
  }

  class DatasetUseCase {
    +addDataset(input)
    +editDataset(id, dataset)
    +getDataset(id)
    +downloadDataset(datasetId)
    +uploadRawDataset(datasetId, url)
    +setSchema(datasetId, schemaId)
    +listDatasets(filter, page, pageSize)
    +getDatasetDescription(datasetId)
    +listOwnedDatasets(userId)
    +listQualityControllableDatasets()
  }

  class DataRelatedRequestUseCases {
    +submitDataRelatedRequest(datasetId, payload): Promise<DataRelatedRequestDto>
    +listDataRelatedRequests(datasetId, page, pageSize): Promise<DataRelatedRequestDto[]>
  }

  class DataRelatedRequestPayload {
    +subject: string
    +description: string
  }

  class DataRelatedRequestDto {
    +id: string
    +datasetId: string
    +requesterId: string
    +requesterUsername: string
    +subject: string
    +description: string
    +status: string
    +createdAt: string
    +updatedAt: string
  }
}

package "DI Container" {
  class UCContainer {
    +dataset: DatasetUseCases
  }
}

package "API (frontend client)" {
  class ApiClient {
    +GET(path, options)
    +POST(path, options)
    +PUT(path, options)
  }
  class FetchAPI {
    +fetch(url, init)
  }
}

DatasetDetailPresenter --> DatasetInfoView : render()
DatasetInfoView --> DatasetDetailPresenter : props/events
DatasetDetailPresenter --> DatasetsController : loadDataset(id)

CatalogDetailPresenter --> DatasetTableView : render()
DatasetTableView --> CatalogDetailPresenter : onOpen(id)
CatalogDetailPresenter --> AddDatasetSectionView : render()
AddDatasetSectionView --> AddDatasetFormView : compose
AddDatasetFormView --> CatalogDetailPresenter : onSubmit(input)
CatalogDetailPresenter --> DatasetsController : add/list datasets
CatalogDetailPresenter --> CatalogsController : get catalog context
DatasetDetailPresenter --> DatasetCommentsView : render(comments)

DatasetsController --> DatasetUseCases : delegates
CatalogsController --> DatasetUseCases : delegates shared calls

DatasetsController --> UCContainer : reads dataset uc
CatalogsController --> UCContainer : reads dataset uc
UCContainer --> DatasetUseCases : provides implementation

AddDataRelatedRequestModal --> DataRelatedRequestUseCases : submit/list
DataRelatedRequestUseCases ..> FetchAPI : fetch()

DatasetUseCases <|.. DatasetUseCase
DataRelatedRequestUseCases ..> DataRelatedRequestPayload
DataRelatedRequestUseCases ..> DataRelatedRequestDto

@enduml