#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

BRANCH="$(git rev-parse --abbrev-ref HEAD)"

# Block protected branches
if [ "$BRANCH" = "main" ]; then
  echo "Husky: Push blocked. Pushing to '$BRANCH' is not allowed."
  exit 1
fi

# Allowed types (extend as needed)
TYPES="feat|fix|chore|docs|refactor|test|perf"

# Enforce pattern: <issueNumber>-<type>/<kebab-name>
# Examples:
#   10-fix-resolve-problem-with-button
#   234-feat-add-login-form
if echo "$BRANCH" | grep -Eq "^[0-9]+-($TYPES)-[a-z0-9]+(-[a-z0-9]+)*$"; then
  echo "Husky: push allowed on '$BRANCH'."
  exit 0
fi

echo "Husky: Push blocked. Invalid branch name: '$BRANCH'"
echo "Expected: <issueNumber>-<type>-<kebab-issue-name>"
echo "Allowed <type>: $TYPES"
echo "Examples:"
echo "  10-fix-resolve-problem-with-button"
echo "  234-feat-add-login-form"
exit 1